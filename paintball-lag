--// HUB: Spam Tools v2 + Auto Laser + Spam Laser + Tool Toggles + Spin
local player = game.Players.LocalPlayer
local players = game.Players
local rs = game:GetService("RunService")
local replicated = game:GetService("ReplicatedStorage")

local remote = replicated:WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RE/UseItem")

-- GUI
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.ResetOnSpawn = false

-- Hub Frame
local hub = Instance.new("Frame", gui)
hub.Size = UDim2.new(0, 220, 0, 260)
hub.Position = UDim2.new(0.7, 0, 0.25, 0)
hub.BackgroundColor3 = Color3.fromRGB(0,0,0)
hub.Active = true
hub.Draggable = true
hub.BorderSizePixel = 0
Instance.new("UICorner", hub).CornerRadius = UDim.new(0,15)

-- Tool toggles
local toolToggles = {Megaphone=false, RageTable=false, BeeLauncher=false}
local yPos = 10
for tool,_ in pairs(toolToggles) do
    local btnToggle = Instance.new("TextButton", hub)
    btnToggle.Size = UDim2.new(1, -20, 0, 30)
    btnToggle.Position = UDim2.new(0, 10, 0, yPos)
    btnToggle.BackgroundColor3 = Color3.fromRGB(30,30,30)
    btnToggle.Text = tool..": OFF"
    btnToggle.TextColor3 = Color3.new(1,1,1)
    btnToggle.Font = Enum.Font.GothamBold
    btnToggle.TextScaled = true
    Instance.new("UICorner", btnToggle).CornerRadius = UDim.new(0,8)
    btnToggle.MouseButton1Click:Connect(function()
        toolToggles[tool] = not toolToggles[tool]
        btnToggle.Text = tool..": "..(toolToggles[tool] and "ON" or "OFF")
    end)
    yPos = yPos + 35
end

-- Spam Tools Button
local btn = Instance.new("TextButton", hub)
btn.Size = UDim2.new(1, -20, 0, 50)
btn.Position = UDim2.new(0, 10, 0, yPos)
btn.BackgroundColor3 = Color3.fromRGB(0,0,0)
btn.Text = "Spam Tools v2 [OFF]"
btn.TextColor3 = Color3.new(1,1,1)
btn.Font = Enum.Font.GothamBold
btn.TextScaled = true
Instance.new("UICorner", btn).CornerRadius = UDim.new(0,12)
yPos += 60

local enabled = false
local loopConn

-- Auto Laser Button
local laserBtn = Instance.new("TextButton", hub)
laserBtn.Size = UDim2.new(1, -20, 0, 40)
laserBtn.Position = UDim2.new(0, 10, 0, yPos)
laserBtn.BackgroundColor3 = Color3.fromRGB(0,0,0)
laserBtn.Text = "Auto Laser [OFF]"
laserBtn.TextColor3 = Color3.new(1,1,1)
laserBtn.Font = Enum.Font.GothamBold
laserBtn.TextScaled = true
Instance.new("UICorner", laserBtn).CornerRadius = UDim.new(0,12)
yPos += 50

local laserEnabled = false

-- Spam Laser Button
local spamLaserBtn = Instance.new("TextButton", hub)
spamLaserBtn.Size = UDim2.new(1, -20, 0, 40)
spamLaserBtn.Position = UDim2.new(0, 10, 0, yPos)
spamLaserBtn.BackgroundColor3 = Color3.fromRGB(0,0,0)
spamLaserBtn.Text = "Spam Laser [OFF]"
spamLaserBtn.TextColor3 = Color3.new(1,1,1)
spamLaserBtn.Font = Enum.Font.GothamBold
spamLaserBtn.TextScaled = true
Instance.new("UICorner", spamLaserBtn).CornerRadius = UDim.new(0,12)

local spamLaser = false
local spamLaserConn

-- RGB Fade
local t = 0
rs.RenderStepped:Connect(function(dt)
    t += dt*2
    local alpha = (math.sin(t)+1)/2
    btn.BackgroundColor3 = Color3.fromRGB(math.floor(0 + 155*alpha),0,math.floor(0 + 255*alpha))

    if laserEnabled then
        laserBtn.BackgroundColor3 = Color3.fromRGB(math.floor(0 + 155*alpha),0,math.floor(0 + 255*alpha))
    else
        laserBtn.BackgroundColor3 = Color3.fromRGB(0,0,0)
    end

    if spamLaser then
        spamLaserBtn.BackgroundColor3 = Color3.fromRGB(math.floor(0 + 155*alpha),0,math.floor(0 + 255*alpha))
    else
        spamLaserBtn.BackgroundColor3 = Color3.fromRGB(0,0,0)
    end
end)

-- RETURNS nearest player's __HITBOX
local function getNearestHitbox()
    local char = player.Character
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    if not root then return end

    local nearestDist = math.huge
    local target = nil

    for _, plr in ipairs(players:GetPlayers()) do
        if plr ~= player and plr.Character then
            local hb = plr.Character:FindFirstChild("__HITBOX")
            if hb then
                local dist = (hb.Position - root.Position).Magnitude
                if dist < nearestDist then
                    nearestDist = dist
                    target = hb
                end
            end
        end
    end

    return target
end

-- Equip + spam helper
local function equipAndSpam(toolName,duration)
    local char = player.Character
    if not char then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum then return end
    local backpack = player:FindFirstChildOfClass("Backpack")
    local tool = char:FindFirstChild(toolName) or (backpack and backpack:FindFirstChild(toolName))
    if not tool then return end
    if tool.Parent ~= char then hum:EquipTool(tool) end

    local start = tick()
    while tick() - start < duration do
        if tool.Parent ~= char then hum:EquipTool(tool) end
        tool:Activate()
        task.wait(0.01)
    end
end

-- Paintball spam loop
local function startLoop()
    if loopConn then loopConn:Disconnect() end
    loopConn = rs.Heartbeat:Connect(function()
        if not enabled then return end
        local char = player.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if not hum then return end

        local backpack = player:FindFirstChildOfClass("Backpack")
        local paint = char:FindFirstChild("Paintball Gun") or (backpack and backpack:FindFirstChild("Paintball Gun"))
        if not paint then return end

        if paint.Parent ~= char then hum:EquipTool(paint) end
        paint:Activate()

        local hb = getNearestHitbox()
        if hb then
            remote:FireServer(hb.Position, hb)
        end
    end)
end

-- Spin logic
local function applySpin(state)
    local function stop()
        local char = player.Character
        if not char then return end
        local root = char:FindFirstChild("HumanoidRootPart")
        if not root then return end
        local s = root:FindFirstChild("Spinning")
        if s then s:Destroy() end
    end

    if not state then stop(); return end

    local SPEED = 20
    local function apply()
        local char = player.Character
        if not char then return end
        local root = char:FindFirstChild("HumanoidRootPart")
        if not root then return end
        local old = root:FindFirstChild("Spinning")
        if old then old:Destroy() end

        local spin = Instance.new("BodyAngularVelocity")
        spin.Name = "Spinning"
        spin.Parent = root
        spin.MaxTorque = Vector3.new(0, math.huge, 0)
        spin.AngularVelocity = Vector3.new(0, SPEED, 0)
    end

    apply()
    player.CharacterAdded:Connect(function()
        task.wait(0.1)
        apply()
    end)
end

-- Spam Tools toggle
btn.MouseButton1Click:Connect(function()
    enabled = not enabled
    applySpin(enabled)
    if enabled then
        btn.Text = "Spam Tools v2 [ON]"
        local anyTools =
            toolToggles["Megaphone"] or
            toolToggles["RageTable"] or
            toolToggles["BeeLauncher"]

        if anyTools then
            task.spawn(function()
                if toolToggles["Megaphone"] then equipAndSpam("Megaphone",0.2) end
                if toolToggles["RageTable"] then equipAndSpam("Rage Table",0.5) end
                if toolToggles["BeeLauncher"] then equipAndSpam("Bee Launcher",0.5) end
            end)
            task.delay(0, startLoop)
        else
            startLoop()
        end
    else
        btn.Text = "Spam Tools v2 [OFF]"
        if loopConn then loopConn:Disconnect() end
    end
end)

-- Auto Laser toggle
laserBtn.MouseButton1Click:Connect(function()
    laserEnabled = not laserEnabled
    laserBtn.Text = "Auto Laser [" .. (laserEnabled and "ON" or "OFF") .. "]"
end)

-- Auto Laser logic
local notifFolder = player:WaitForChild("PlayerGui"):WaitForChild("Notification"):WaitForChild("Notification")
notifFolder.ChildAdded:Connect(function(child)
    if not laserEnabled then return end

    task.wait(0.05)
    local textLabel = child:FindFirstChildWhichIsA("TextLabel")
    if textLabel and textLabel.Text:match("Someone is stealing your") then
        
        -- Equip laser
        local char = player.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hum then
            local cape = char:FindFirstChild("Laser Cape") or player.Backpack:FindFirstChild("Laser Cape")
            if cape then hum:EquipTool(cape) end
        end
        
        local hb = getNearestHitbox()
        if hb then
            remote:FireServer(hb.Position, hb)
        end

        -- Auto Laser unequips
        task.wait(0.1)
        if hum then hum:UnequipTools() end
    end
end)

-- Spam Laser toggle
spamLaserBtn.MouseButton1Click:Connect(function()
    spamLaser = not spamLaser
    spamLaserBtn.Text = "Spam Laser [" .. (spamLaser and "ON" or "OFF") .. "]"

    if spamLaser then
        -- Equip cape immediately
        local char = player.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hum then
            local cape = char:FindFirstChild("Laser Cape") or player.Backpack:FindFirstChild("Laser Cape")
            if cape then hum:EquipTool(cape) end
        end
        
        -- Start spamming
        spamLaserConn = rs.Heartbeat:Connect(function()
            if not spamLaser then return end
            local hb = getNearestHitbox()
            if hb then
                remote:FireServer(hb.Position, hb)
            end
        end)
    else
        if spamLaserConn then spamLaserConn:Disconnect() end
    end
end)
