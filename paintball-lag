--// HUB: Spam Tools v2 + Auto Laser + Tool Toggles + Spin
local player = game.Players.LocalPlayer
local players = game.Players
local rs = game:GetService("RunService")
local replicated = game:GetService("ReplicatedStorage")
local workspace = game:GetService("Workspace")

local remote = replicated:WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RE/UseItem")

-- GUI
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.ResetOnSpawn = false

-- Hub Frame
local hub = Instance.new("Frame", gui)
hub.Size = UDim2.new(0, 220, 0, 200)
hub.Position = UDim2.new(0.7, 0, 0.25, 0)
hub.BackgroundColor3 = Color3.fromRGB(0,0,0)
hub.Active = true
hub.Draggable = true
hub.BorderSizePixel = 0
Instance.new("UICorner", hub).CornerRadius = UDim.new(0,15)

-- Tool toggles
local toolToggles = {Megaphone=false, RageTable=false, BeeLauncher=false}
local yPos = 10
for tool,_ in pairs(toolToggles) do
    local btnToggle = Instance.new("TextButton", hub)
    btnToggle.Size = UDim2.new(1, -20, 0, 30)
    btnToggle.Position = UDim2.new(0, 10, 0, yPos)
    btnToggle.BackgroundColor3 = Color3.fromRGB(30,30,30)
    btnToggle.Text = tool..": OFF"
    btnToggle.TextColor3 = Color3.new(1,1,1)
    btnToggle.Font = Enum.Font.GothamBold
    btnToggle.TextScaled = true
    Instance.new("UICorner", btnToggle).CornerRadius = UDim.new(0,8)
    btnToggle.MouseButton1Click:Connect(function()
        toolToggles[tool] = not toolToggles[tool]
        btnToggle.Text = tool..": "..(toolToggles[tool] and "ON" or "OFF")
    end)
    yPos = yPos + 35
end

-- Spam Tools Button
local btn = Instance.new("TextButton", hub)
btn.Size = UDim2.new(1, -20, 0, 50)
btn.Position = UDim2.new(0, 10, 0, yPos)
btn.BackgroundColor3 = Color3.fromRGB(0,0,0)
btn.Text = "Spam Tools v2 [OFF]"
btn.TextColor3 = Color3.new(1,1,1)
btn.Font = Enum.Font.GothamBold
btn.TextScaled = true
Instance.new("UICorner", btn).CornerRadius = UDim.new(0,12)
yPos = yPos + 60

local enabled = false
local loopConn

-- Auto Laser Button
local laserBtn = Instance.new("TextButton", hub)
laserBtn.Size = UDim2.new(1, -20, 0, 50)
laserBtn.Position = UDim2.new(0, 10, 0, yPos)
laserBtn.BackgroundColor3 = Color3.fromRGB(0,0,0)
laserBtn.Text = "Auto Laser [OFF]"
laserBtn.TextColor3 = Color3.new(1,1,1)
laserBtn.Font = Enum.Font.GothamBold
laserBtn.TextScaled = true
Instance.new("UICorner", laserBtn).CornerRadius = UDim.new(0,12)

local laserEnabled = false

-- RGB Fade
local t = 0
rs.RenderStepped:Connect(function(dt)
    t = t + dt*2
    local alpha = (math.sin(t)+1)/2
    btn.BackgroundColor3 = Color3.fromRGB(math.floor(0 + 155*alpha),0,math.floor(0 + 255*alpha))
    laserBtn.BackgroundColor3 = laserEnabled and Color3.fromRGB(math.floor(0 + 155*alpha),0,math.floor(0 + 255*alpha)) or Color3.fromRGB(0,0,0)
end)

-- Find nearest player HRP
local function getNearestPlayerHrp()
    local char = player.Character
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    if not root then return end
    local nearestDist = math.huge
    local nearest = nil
    for _, plr in ipairs(players:GetPlayers()) do
        if plr ~= player and plr.Character then
            local hrp = plr.Character:FindFirstChild("HumanoidRootPart")
            local hum = plr.Character:FindFirstChildOfClass("Humanoid")
            if hrp and hum and hum.Health > 0 then
                local dist = (hrp.Position - root.Position).Magnitude
                if dist < nearestDist then
                    nearestDist = dist
                    nearest = hrp
                end
            end
        end
    end
    return nearest
end

-- Equip and spam tool
local function equipAndSpam(toolName,duration)
    local char = player.Character
    if not char then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum then return end
    local backpack = player:FindFirstChildOfClass("Backpack")
    local tool = char:FindFirstChild(toolName) or (backpack and backpack:FindFirstChild(toolName))
    if not tool then return end
    if tool.Parent ~= char then hum:EquipTool(tool) end
    local start = tick()
    while tick() - start < duration do
        if tool.Parent ~= char then hum:EquipTool(tool) end
        tool:Activate()
        task.wait(0.01)
    end
end

-- Paintball spam loop
local function startLoop()
    if loopConn then loopConn:Disconnect() end
    loopConn = rs.Heartbeat:Connect(function()
        if not enabled then return end
        local char = player.Character
        if not char then return end
        local hum = char:FindFirstChildOfClass("Humanoid")
        if not hum then return end
        local backpack = player:FindFirstChildOfClass("Backpack")
        local paint = char:FindFirstChild("Paintball Gun") or (backpack and backpack:FindFirstChild("Paintball Gun"))
        if paint then
            if paint.Parent ~= char then hum:EquipTool(paint) end
            paint:Activate()
            local nearest = getNearestPlayerHrp()
            if nearest then
                local pos = nearest.Position
                remote:FireServer(Vector3.new(pos.X,pos.Y,pos.Z))
            end
        end
    end)
end

-- Spin logic
local function applySpin(state)
    local function stop()
        local char = player.Character
        if not char then return end
        local root = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso") or char:FindFirstChild("UpperTorso")
        if root then
            local s = root:FindFirstChild("Spinning")
            if s then s:Destroy() end
        end
    end
    if not state then stop(); return end

    local SPEED = 20
    local function apply()
        local char = player.Character
        if not char then return end
        local root = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso") or char:FindFirstChild("UpperTorso")
        if not root then return end
        local old = root:FindFirstChild("Spinning")
        if old then old:Destroy() end
        local spin = Instance.new("BodyAngularVelocity")
        spin.Name = "Spinning"
        spin.Parent = root
        spin.MaxTorque = Vector3.new(0,math.huge,0)
        spin.AngularVelocity = Vector3.new(0,SPEED,0)
    end
    apply()
    player.CharacterAdded:Connect(function()
        task.wait(0.1)
        apply()
    end)
end

-- Spam Tools toggle
btn.MouseButton1Click:Connect(function()
    enabled = not enabled
    applySpin(enabled)
    if enabled then
        btn.Text = "Spam Tools v2 [ON]"
        
        local anyTools = toolToggles["Megaphone"] or toolToggles["RageTable"] or toolToggles["BeeLauncher"]

        if anyTools then
            -- Run selected tools first
            task.spawn(function()
                if toolToggles["Megaphone"] then equipAndSpam("Megaphone",0.2) end
                if toolToggles["RageTable"] then equipAndSpam("Rage Table",0.5) end
                if toolToggles["BeeLauncher"] then equipAndSpam("Bee Launcher",0.5) end
            end)
            -- Start Paintball spam after 1 second
            task.delay(0, startLoop)
        else
            -- No tools selected, start Paintball spam immediately
            startLoop()
        end
    else
        btn.Text = "Spam Tools v2 [OFF]"
        if loopConn then loopConn:Disconnect() end
    end
end)

-- Auto Laser toggle
laserBtn.MouseButton1Click:Connect(function()
    laserEnabled = not laserEnabled
    laserBtn.Text = "Auto Laser ["..(laserEnabled and "ON" or "OFF").."]"
end)

-- Auto Laser logic
local notifFolder = player:WaitForChild("PlayerGui"):WaitForChild("Notification"):WaitForChild("Notification")
notifFolder.ChildAdded:Connect(function(child)
    if not laserEnabled then return end
    task.wait(0.05)
    local textLabel = child:FindFirstChildWhichIsA("TextLabel")
    if textLabel and textLabel.Text:match("Someone is stealing your") then
        local char = player.Character
        if char then
            local hum = char:FindFirstChildOfClass("Humanoid")
            local backpack = player:FindFirstChildOfClass("Backpack")
            local cape = char:FindFirstChild("Laser Cape") or (backpack and backpack:FindFirstChild("Laser Cape"))
            if cape and cape.Parent ~= char and hum then
                hum:EquipTool(cape)
            end
        end
        local nearest = getNearestPlayerHrp()
        if nearest and nearest.Parent then
            local upper = nearest.Parent:FindFirstChild("UpperTorso")
            if upper then
                local args = {Vector3.new(upper.Position.X, upper.Position.Y, upper.Position.Z), upper}
                remote:FireServer(unpack(args))
            end
        end
        -- Unequip Laser Cape
        task.wait(0.1)
        local char = player.Character
        if char then
            local hum = char:FindFirstChildOfClass("Humanoid")
            local cape = char:FindFirstChild("Laser Cape")
            if cape and hum then hum:UnequipTools() end
        end
    end
end)
